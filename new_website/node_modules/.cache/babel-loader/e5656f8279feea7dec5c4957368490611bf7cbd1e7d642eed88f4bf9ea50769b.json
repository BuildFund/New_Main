{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\paul-\\\\OneDrive - BARE Capital Ltd\\\\BARE Drive\\\\10.0 BUILDFUND\\\\1.0 Website Dev\\\\GitHub\\\\new_website\\\\src\\\\pages\\\\Messages.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useState, useRef } from 'react';\nimport { useSearchParams } from 'react-router-dom';\nimport api from '../api';\nimport { theme, commonStyles } from '../styles/theme';\nimport Button from '../components/Button';\nimport Textarea from '../components/Textarea';\nimport Input from '../components/Input';\nimport Badge from '../components/Badge';\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nfunction Messages() {\n  _s();\n  const [searchParams] = useSearchParams();\n  const applicationId = searchParams.get('application_id');\n  const [messages, setMessages] = useState([]);\n  const [applications, setApplications] = useState([]);\n  const [selectedApplication, setSelectedApplication] = useState(applicationId || '');\n  const [newMessage, setNewMessage] = useState({\n    subject: '',\n    body: '',\n    recipient: ''\n  });\n  const [error, setError] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const [sending, setSending] = useState(false);\n  const [uploading, setUploading] = useState(false);\n  const [selectedFiles, setSelectedFiles] = useState([]);\n  const messagesEndRef = useRef(null);\n  const fileInputRef = useRef(null);\n  useEffect(() => {\n    loadApplications();\n    if (applicationId) {\n      setSelectedApplication(applicationId);\n      loadMessages(applicationId);\n    } else {\n      setLoading(false);\n    }\n  }, [applicationId]);\n  async function loadApplications() {\n    try {\n      const res = await api.get('/api/applications/');\n      setApplications(res.data || []);\n    } catch (err) {\n      console.error('Messages loadApplications error:', err);\n    }\n  }\n  async function loadMessages(appId) {\n    if (!appId) {\n      setMessages([]);\n      return;\n    }\n    setLoading(true);\n    setError(null);\n    try {\n      const res = await api.get(`/api/messaging/messages/by_application/?application_id=${appId}`);\n      // Reverse to show newest at bottom (WhatsApp style)\n      const messagesList = res.data || [];\n      setMessages([...messagesList].reverse());\n      // Scroll to bottom after messages load\n      setTimeout(() => {\n        var _messagesEndRef$curre;\n        (_messagesEndRef$curre = messagesEndRef.current) === null || _messagesEndRef$curre === void 0 ? void 0 : _messagesEndRef$curre.scrollIntoView({\n          behavior: 'smooth'\n        });\n      }, 100);\n    } catch (err) {\n      console.error('Messages loadMessages error:', err);\n      setError('Failed to load messages');\n    } finally {\n      setLoading(false);\n    }\n  }\n  useEffect(() => {\n    // Scroll to bottom when messages change\n    if (messages.length > 0) {\n      setTimeout(() => {\n        var _messagesEndRef$curre2;\n        (_messagesEndRef$curre2 = messagesEndRef.current) === null || _messagesEndRef$curre2 === void 0 ? void 0 : _messagesEndRef$curre2.scrollIntoView({\n          behavior: 'smooth'\n        });\n      }, 100);\n    }\n  }, [messages]);\n  const handleSelectApplication = e => {\n    const appId = e.target.value;\n    setSelectedApplication(appId);\n    if (appId) {\n      loadMessages(appId);\n      // Find the application to get recipient info\n      const app = applications.find(a => a.id.toString() === appId);\n      if (app) {\n        var _app$project_details, _app$project_details2;\n        // Determine recipient based on user role\n        const userRole = localStorage.getItem('role');\n        let recipientId = '';\n        if (userRole === 'Borrower') {\n          var _app$lender_details, _app$lender_details$u, _app$lender_details2;\n          recipientId = ((_app$lender_details = app.lender_details) === null || _app$lender_details === void 0 ? void 0 : (_app$lender_details$u = _app$lender_details.user) === null || _app$lender_details$u === void 0 ? void 0 : _app$lender_details$u.id) || ((_app$lender_details2 = app.lender_details) === null || _app$lender_details2 === void 0 ? void 0 : _app$lender_details2.user) || '';\n        } else if (userRole === 'Lender') {\n          var _app$borrower_details, _app$borrower_details2, _app$borrower_details3;\n          recipientId = ((_app$borrower_details = app.borrower_details) === null || _app$borrower_details === void 0 ? void 0 : (_app$borrower_details2 = _app$borrower_details.user) === null || _app$borrower_details2 === void 0 ? void 0 : _app$borrower_details2.id) || ((_app$borrower_details3 = app.borrower_details) === null || _app$borrower_details3 === void 0 ? void 0 : _app$borrower_details3.user) || '';\n        }\n        // Auto-populate subject with project reference if available\n        const projectRef = ((_app$project_details = app.project_details) === null || _app$project_details === void 0 ? void 0 : _app$project_details.project_reference) || '';\n        const defaultSubject = projectRef ? `Re: Project ${projectRef}` : `Re: ${((_app$project_details2 = app.project_details) === null || _app$project_details2 === void 0 ? void 0 : _app$project_details2.address) || 'Project'}`;\n        setNewMessage({\n          ...newMessage,\n          recipient: recipientId,\n          subject: newMessage.subject || defaultSubject\n        });\n      }\n    } else {\n      setMessages([]);\n    }\n  };\n  const handleFileSelect = e => {\n    const files = Array.from(e.target.files);\n    setSelectedFiles(files);\n  };\n  const handleRemoveFile = index => {\n    setSelectedFiles(selectedFiles.filter((_, i) => i !== index));\n  };\n  const handleSendMessage = async e => {\n    e.preventDefault();\n    if (!selectedApplication || !newMessage.body.trim() && selectedFiles.length === 0) {\n      setError('Please enter a message or attach a file');\n      return;\n    }\n    setSending(true);\n    setUploading(selectedFiles.length > 0);\n    setError(null);\n    try {\n      var _app$project_details3;\n      const app = applications.find(a => a.id.toString() === selectedApplication);\n      if (!app) {\n        throw new Error('Application not found');\n      }\n\n      // First, upload files if any\n      let uploadedDocuments = [];\n      if (selectedFiles.length > 0) {\n        const formData = new FormData();\n        selectedFiles.forEach(file => {\n          formData.append('files', file);\n        });\n        formData.append('description', `Uploaded via messaging: ${newMessage.body || 'No message'}`);\n        const uploadRes = await api.post(`/api/applications/${selectedApplication}/documents/`, formData, {\n          headers: {\n            'Content-Type': 'multipart/form-data'\n          }\n        });\n        uploadedDocuments = uploadRes.data.documents || [];\n      }\n\n      // Determine recipient if not set\n      let recipientId = newMessage.recipient;\n      if (!recipientId) {\n        const userRole = localStorage.getItem('role');\n        if (userRole === 'Borrower') {\n          var _app$lender_details3, _app$lender_details3$, _app$lender;\n          recipientId = ((_app$lender_details3 = app.lender_details) === null || _app$lender_details3 === void 0 ? void 0 : (_app$lender_details3$ = _app$lender_details3.user) === null || _app$lender_details3$ === void 0 ? void 0 : _app$lender_details3$.id) || ((_app$lender = app.lender) === null || _app$lender === void 0 ? void 0 : _app$lender.id) || '';\n        } else if (userRole === 'Lender') {\n          var _app$borrower_details4, _app$borrower_details5, _app$project, _app$project$borrower, _app$project$borrower2;\n          recipientId = ((_app$borrower_details4 = app.borrower_details) === null || _app$borrower_details4 === void 0 ? void 0 : (_app$borrower_details5 = _app$borrower_details4.user) === null || _app$borrower_details5 === void 0 ? void 0 : _app$borrower_details5.id) || ((_app$project = app.project) === null || _app$project === void 0 ? void 0 : (_app$project$borrower = _app$project.borrower) === null || _app$project$borrower === void 0 ? void 0 : (_app$project$borrower2 = _app$project$borrower.user) === null || _app$project$borrower2 === void 0 ? void 0 : _app$project$borrower2.id) || '';\n        }\n      }\n      if (!recipientId) {\n        setError('Unable to determine recipient. Please select an application.');\n        setSending(false);\n        setUploading(false);\n        return;\n      }\n\n      // Then send the message\n      const messageData = {\n        application: parseInt(selectedApplication),\n        recipient: parseInt(recipientId),\n        subject: newMessage.subject || `Re: ${((_app$project_details3 = app.project_details) === null || _app$project_details3 === void 0 ? void 0 : _app$project_details3.address) || 'Project'}`,\n        body: newMessage.body || (selectedFiles.length > 0 ? `Uploaded ${selectedFiles.length} file(s)` : '')\n      };\n      const messageRes = await api.post('/api/messaging/messages/', messageData);\n\n      // Link uploaded documents to the message if any\n      if (uploadedDocuments.length > 0 && messageRes.data.id) {\n        for (const doc of uploadedDocuments) {\n          try {\n            await api.post('/api/messaging/attachments/', {\n              message: messageRes.data.id,\n              document: doc.document_id\n            });\n          } catch (attachErr) {\n            console.warn('Failed to link document to message:', attachErr);\n          }\n        }\n      }\n      setNewMessage({\n        subject: '',\n        body: '',\n        recipient: ''\n      });\n      setSelectedFiles([]);\n      if (fileInputRef.current) {\n        fileInputRef.current.value = '';\n      }\n      await loadMessages(selectedApplication);\n    } catch (err) {\n      var _err$response, _err$response$data, _err$response2, _err$response2$data;\n      console.error('Messages handleSendMessage error:', err);\n      setError(((_err$response = err.response) === null || _err$response === void 0 ? void 0 : (_err$response$data = _err$response.data) === null || _err$response$data === void 0 ? void 0 : _err$response$data.error) || ((_err$response2 = err.response) === null || _err$response2 === void 0 ? void 0 : (_err$response2$data = _err$response2.data) === null || _err$response2$data === void 0 ? void 0 : _err$response2$data.detail) || 'Failed to send message');\n    } finally {\n      setSending(false);\n      setUploading(false);\n    }\n  };\n  const getOtherPartyName = message => {\n    const currentUserId = parseInt(localStorage.getItem('user_id') || '0');\n    if (message.sender === currentUserId) {\n      return message.recipient_username || 'Recipient';\n    }\n    return message.sender_username || 'Sender';\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: commonStyles.container,\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        marginBottom: theme.spacing.xl\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n        style: {\n          fontSize: theme.typography.fontSize['4xl'],\n          fontWeight: theme.typography.fontWeight.bold,\n          margin: `0 0 ${theme.spacing.sm} 0`,\n          color: theme.colors.textPrimary\n        },\n        children: \"Messages\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 219,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        style: {\n          color: theme.colors.textSecondary,\n          fontSize: theme.typography.fontSize.base,\n          margin: 0\n        },\n        children: \"Communicate with borrowers and lenders about applications\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 227,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 218,\n      columnNumber: 7\n    }, this), error && /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        background: theme.colors.errorLight,\n        color: theme.colors.errorDark,\n        padding: theme.spacing.md,\n        borderRadius: theme.borderRadius.md,\n        marginBottom: theme.spacing.lg,\n        border: `1px solid ${theme.colors.error}`\n      },\n      children: error\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 237,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        display: 'grid',\n        gridTemplateColumns: '1fr 2fr',\n        gap: theme.spacing.xl\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        style: commonStyles.card,\n        children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n          style: {\n            fontSize: theme.typography.fontSize.xl,\n            fontWeight: theme.typography.fontWeight.semibold,\n            margin: `0 0 ${theme.spacing.md} 0`\n          },\n          children: \"Select Application\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 252,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"select\", {\n          value: selectedApplication,\n          onChange: handleSelectApplication,\n          style: {\n            width: '100%',\n            padding: theme.spacing.sm,\n            borderRadius: theme.borderRadius.md,\n            border: `1px solid ${theme.colors.gray300}`,\n            fontSize: theme.typography.fontSize.base\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"option\", {\n            value: \"\",\n            children: \"-- Select an application --\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 270,\n            columnNumber: 13\n          }, this), applications.map(app => {\n            var _app$project_details4, _app$project_details5, _app$lender_details4, _app$borrower_details6;\n            const projectRef = ((_app$project_details4 = app.project_details) === null || _app$project_details4 === void 0 ? void 0 : _app$project_details4.project_reference) || '';\n            const address = ((_app$project_details5 = app.project_details) === null || _app$project_details5 === void 0 ? void 0 : _app$project_details5.address) || `Project #${app.project}`;\n            const otherParty = ((_app$lender_details4 = app.lender_details) === null || _app$lender_details4 === void 0 ? void 0 : _app$lender_details4.organisation_name) || ((_app$borrower_details6 = app.borrower_details) === null || _app$borrower_details6 === void 0 ? void 0 : _app$borrower_details6.company_name) || 'N/A';\n            return /*#__PURE__*/_jsxDEV(\"option\", {\n              value: app.id,\n              children: [projectRef ? `[${projectRef}] ` : '', address, \" - \", otherParty]\n            }, app.id, true, {\n              fileName: _jsxFileName,\n              lineNumber: 276,\n              columnNumber: 17\n            }, this);\n          })]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 259,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 251,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: commonStyles.card,\n        children: !selectedApplication ? /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            textAlign: 'center',\n            padding: theme.spacing['2xl']\n          },\n          children: /*#__PURE__*/_jsxDEV(\"p\", {\n            style: {\n              color: theme.colors.textSecondary\n            },\n            children: \"Select an application to view messages\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 288,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 287,\n          columnNumber: 13\n        }, this) : loading ? /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            textAlign: 'center',\n            padding: theme.spacing['2xl']\n          },\n          children: /*#__PURE__*/_jsxDEV(\"p\", {\n            style: {\n              color: theme.colors.textSecondary\n            },\n            children: \"Loading messages...\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 294,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 293,\n          columnNumber: 13\n        }, this) : /*#__PURE__*/_jsxDEV(_Fragment, {\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              maxHeight: '500px',\n              overflowY: 'auto',\n              marginBottom: theme.spacing.lg,\n              padding: theme.spacing.md,\n              background: theme.colors.gray50,\n              borderRadius: theme.borderRadius.md,\n              display: 'flex',\n              flexDirection: 'column'\n            },\n            children: messages.length === 0 ? /*#__PURE__*/_jsxDEV(\"p\", {\n              style: {\n                color: theme.colors.textSecondary,\n                textAlign: 'center'\n              },\n              children: \"No messages yet. Start the conversation below.\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 309,\n              columnNumber: 19\n            }, this) : /*#__PURE__*/_jsxDEV(_Fragment, {\n              children: [messages.map(message => {\n                const isSent = message.sender_username === localStorage.getItem('username');\n                return /*#__PURE__*/_jsxDEV(\"div\", {\n                  style: {\n                    marginBottom: theme.spacing.sm,\n                    padding: theme.spacing.sm,\n                    background: isSent ? theme.colors.primary : theme.colors.white,\n                    color: isSent ? theme.colors.white : theme.colors.textPrimary,\n                    borderRadius: theme.borderRadius.md,\n                    maxWidth: '75%',\n                    alignSelf: isSent ? 'flex-end' : 'flex-start',\n                    boxShadow: '0 1px 2px rgba(0,0,0,0.1)'\n                  },\n                  children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                    style: {\n                      fontSize: theme.typography.fontSize.xs,\n                      opacity: 0.8,\n                      marginBottom: theme.spacing.xs\n                    },\n                    children: new Date(message.created_at).toLocaleTimeString()\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 330,\n                    columnNumber: 27\n                  }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                    style: {\n                      marginBottom: theme.spacing.xs\n                    },\n                    children: message.body\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 337,\n                    columnNumber: 27\n                  }, this), message.attachments && message.attachments.length > 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n                    style: {\n                      marginTop: theme.spacing.xs\n                    },\n                    children: message.attachments.map((att, idx) => {\n                      var _att$document;\n                      return /*#__PURE__*/_jsxDEV(\"div\", {\n                        style: {\n                          fontSize: theme.typography.fontSize.xs,\n                          opacity: 0.9,\n                          marginTop: theme.spacing.xs\n                        },\n                        children: [\"\\uD83D\\uDCCE \", ((_att$document = att.document) === null || _att$document === void 0 ? void 0 : _att$document.file_name) || 'Attachment']\n                      }, idx, true, {\n                        fileName: _jsxFileName,\n                        lineNumber: 343,\n                        columnNumber: 33\n                      }, this);\n                    })\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 341,\n                    columnNumber: 29\n                  }, this)]\n                }, message.id, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 317,\n                  columnNumber: 25\n                }, this);\n              }), /*#__PURE__*/_jsxDEV(\"div\", {\n                ref: messagesEndRef\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 356,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 298,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"form\", {\n            onSubmit: handleSendMessage,\n            children: [/*#__PURE__*/_jsxDEV(Input, {\n              label: \"Subject\",\n              value: newMessage.subject,\n              onChange: e => setNewMessage({\n                ...newMessage,\n                subject: e.target.value\n              }),\n              placeholder: \"Message subject (optional)\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 363,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(Textarea, {\n              label: \"Message\",\n              value: newMessage.body,\n              onChange: e => setNewMessage({\n                ...newMessage,\n                body: e.target.value\n              }),\n              placeholder: \"Type your message here...\",\n              rows: 3\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 369,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              style: {\n                marginBottom: theme.spacing.md\n              },\n              children: [/*#__PURE__*/_jsxDEV(\"input\", {\n                ref: fileInputRef,\n                type: \"file\",\n                multiple: true,\n                onChange: handleFileSelect,\n                style: {\n                  display: 'none'\n                }\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 379,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                style: {\n                  display: 'flex',\n                  gap: theme.spacing.sm,\n                  alignItems: 'center'\n                },\n                children: [/*#__PURE__*/_jsxDEV(Button, {\n                  type: \"button\",\n                  variant: \"outline\",\n                  size: \"sm\",\n                  onClick: () => {\n                    var _fileInputRef$current;\n                    return (_fileInputRef$current = fileInputRef.current) === null || _fileInputRef$current === void 0 ? void 0 : _fileInputRef$current.click();\n                  },\n                  children: \"\\uD83D\\uDCCE Attach Files\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 387,\n                  columnNumber: 21\n                }, this), selectedFiles.length > 0 && /*#__PURE__*/_jsxDEV(\"span\", {\n                  style: {\n                    fontSize: theme.typography.fontSize.sm,\n                    color: theme.colors.textSecondary\n                  },\n                  children: [selectedFiles.length, \" file(s) selected\"]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 396,\n                  columnNumber: 23\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 386,\n                columnNumber: 19\n              }, this), selectedFiles.length > 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n                style: {\n                  marginTop: theme.spacing.sm\n                },\n                children: selectedFiles.map((file, index) => /*#__PURE__*/_jsxDEV(\"div\", {\n                  style: {\n                    display: 'flex',\n                    alignItems: 'center',\n                    justifyContent: 'space-between',\n                    padding: theme.spacing.xs,\n                    background: theme.colors.gray100,\n                    borderRadius: theme.borderRadius.sm,\n                    marginBottom: theme.spacing.xs\n                  },\n                  children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                    style: {\n                      fontSize: theme.typography.fontSize.sm\n                    },\n                    children: [file.name, \" (\", (file.size / 1024).toFixed(1), \" KB)\"]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 413,\n                    columnNumber: 27\n                  }, this), /*#__PURE__*/_jsxDEV(Button, {\n                    type: \"button\",\n                    variant: \"outline\",\n                    size: \"sm\",\n                    onClick: () => handleRemoveFile(index),\n                    children: \"\\xD7\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 416,\n                    columnNumber: 27\n                  }, this)]\n                }, index, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 404,\n                  columnNumber: 25\n                }, this))\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 402,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 378,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(Button, {\n              type: \"submit\",\n              disabled: sending || uploading || !newMessage.body.trim() && selectedFiles.length === 0,\n              variant: \"primary\",\n              children: uploading ? 'Uploading...' : sending ? 'Sending...' : 'Send Message'\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 430,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 362,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 285,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 249,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 217,\n    columnNumber: 5\n  }, this);\n}\n_s(Messages, \"Oh6/Hkn+W/z8PBY0oBnKD4Rk2Dc=\", false, function () {\n  return [useSearchParams];\n});\n_c = Messages;\nexport default Messages;\nvar _c;\n$RefreshReg$(_c, \"Messages\");","map":{"version":3,"names":["React","useEffect","useState","useRef","useSearchParams","api","theme","commonStyles","Button","Textarea","Input","Badge","jsxDEV","_jsxDEV","Fragment","_Fragment","Messages","_s","searchParams","applicationId","get","messages","setMessages","applications","setApplications","selectedApplication","setSelectedApplication","newMessage","setNewMessage","subject","body","recipient","error","setError","loading","setLoading","sending","setSending","uploading","setUploading","selectedFiles","setSelectedFiles","messagesEndRef","fileInputRef","loadApplications","loadMessages","res","data","err","console","appId","messagesList","reverse","setTimeout","_messagesEndRef$curre","current","scrollIntoView","behavior","length","_messagesEndRef$curre2","handleSelectApplication","e","target","value","app","find","a","id","toString","_app$project_details","_app$project_details2","userRole","localStorage","getItem","recipientId","_app$lender_details","_app$lender_details$u","_app$lender_details2","lender_details","user","_app$borrower_details","_app$borrower_details2","_app$borrower_details3","borrower_details","projectRef","project_details","project_reference","defaultSubject","address","handleFileSelect","files","Array","from","handleRemoveFile","index","filter","_","i","handleSendMessage","preventDefault","trim","_app$project_details3","Error","uploadedDocuments","formData","FormData","forEach","file","append","uploadRes","post","headers","documents","_app$lender_details3","_app$lender_details3$","_app$lender","lender","_app$borrower_details4","_app$borrower_details5","_app$project","_app$project$borrower","_app$project$borrower2","project","borrower","messageData","application","parseInt","messageRes","doc","message","document","document_id","attachErr","warn","_err$response","_err$response$data","_err$response2","_err$response2$data","response","detail","getOtherPartyName","currentUserId","sender","recipient_username","sender_username","style","container","children","marginBottom","spacing","xl","fontSize","typography","fontWeight","bold","margin","sm","color","colors","textPrimary","fileName","_jsxFileName","lineNumber","columnNumber","textSecondary","base","background","errorLight","errorDark","padding","md","borderRadius","lg","border","display","gridTemplateColumns","gap","card","semibold","onChange","width","gray300","map","_app$project_details4","_app$project_details5","_app$lender_details4","_app$borrower_details6","otherParty","organisation_name","company_name","textAlign","maxHeight","overflowY","gray50","flexDirection","isSent","primary","white","maxWidth","alignSelf","boxShadow","xs","opacity","Date","created_at","toLocaleTimeString","attachments","marginTop","att","idx","_att$document","file_name","ref","onSubmit","label","placeholder","rows","type","multiple","alignItems","variant","size","onClick","_fileInputRef$current","click","justifyContent","gray100","name","toFixed","disabled","_c","$RefreshReg$"],"sources":["C:/Users/paul-/OneDrive - BARE Capital Ltd/BARE Drive/10.0 BUILDFUND/1.0 Website Dev/GitHub/new_website/src/pages/Messages.js"],"sourcesContent":["import React, { useEffect, useState, useRef } from 'react';\r\nimport { useSearchParams } from 'react-router-dom';\r\nimport api from '../api';\r\nimport { theme, commonStyles } from '../styles/theme';\r\nimport Button from '../components/Button';\r\nimport Textarea from '../components/Textarea';\r\nimport Input from '../components/Input';\r\nimport Badge from '../components/Badge';\r\n\r\nfunction Messages() {\r\n  const [searchParams] = useSearchParams();\r\n  const applicationId = searchParams.get('application_id');\r\n  \r\n  const [messages, setMessages] = useState([]);\r\n  const [applications, setApplications] = useState([]);\r\n  const [selectedApplication, setSelectedApplication] = useState(applicationId || '');\r\n  const [newMessage, setNewMessage] = useState({ subject: '', body: '', recipient: '' });\r\n  const [error, setError] = useState(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [sending, setSending] = useState(false);\r\n  const [uploading, setUploading] = useState(false);\r\n  const [selectedFiles, setSelectedFiles] = useState([]);\r\n  const messagesEndRef = useRef(null);\r\n  const fileInputRef = useRef(null);\r\n\r\n  useEffect(() => {\r\n    loadApplications();\r\n    if (applicationId) {\r\n      setSelectedApplication(applicationId);\r\n      loadMessages(applicationId);\r\n    } else {\r\n      setLoading(false);\r\n    }\r\n  }, [applicationId]);\r\n\r\n  async function loadApplications() {\r\n    try {\r\n      const res = await api.get('/api/applications/');\r\n      setApplications(res.data || []);\r\n    } catch (err) {\r\n      console.error('Messages loadApplications error:', err);\r\n    }\r\n  }\r\n\r\n  async function loadMessages(appId) {\r\n    if (!appId) {\r\n      setMessages([]);\r\n      return;\r\n    }\r\n\r\n    setLoading(true);\r\n    setError(null);\r\n    try {\r\n      const res = await api.get(`/api/messaging/messages/by_application/?application_id=${appId}`);\r\n      // Reverse to show newest at bottom (WhatsApp style)\r\n      const messagesList = res.data || [];\r\n      setMessages([...messagesList].reverse());\r\n      // Scroll to bottom after messages load\r\n      setTimeout(() => {\r\n        messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\r\n      }, 100);\r\n    } catch (err) {\r\n      console.error('Messages loadMessages error:', err);\r\n      setError('Failed to load messages');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }\r\n\r\n  useEffect(() => {\r\n    // Scroll to bottom when messages change\r\n    if (messages.length > 0) {\r\n      setTimeout(() => {\r\n        messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\r\n      }, 100);\r\n    }\r\n  }, [messages]);\r\n\r\n  const handleSelectApplication = (e) => {\r\n    const appId = e.target.value;\r\n    setSelectedApplication(appId);\r\n    if (appId) {\r\n      loadMessages(appId);\r\n      // Find the application to get recipient info\r\n      const app = applications.find(a => a.id.toString() === appId);\r\n      if (app) {\r\n        // Determine recipient based on user role\r\n        const userRole = localStorage.getItem('role');\r\n        let recipientId = '';\r\n        if (userRole === 'Borrower') {\r\n          recipientId = app.lender_details?.user?.id || app.lender_details?.user || '';\r\n        } else if (userRole === 'Lender') {\r\n          recipientId = app.borrower_details?.user?.id || app.borrower_details?.user || '';\r\n        }\r\n        // Auto-populate subject with project reference if available\r\n        const projectRef = app.project_details?.project_reference || '';\r\n        const defaultSubject = projectRef \r\n          ? `Re: Project ${projectRef}`\r\n          : `Re: ${app.project_details?.address || 'Project'}`;\r\n        setNewMessage({ \r\n          ...newMessage, \r\n          recipient: recipientId,\r\n          subject: newMessage.subject || defaultSubject,\r\n        });\r\n      }\r\n    } else {\r\n      setMessages([]);\r\n    }\r\n  };\r\n\r\n  const handleFileSelect = (e) => {\r\n    const files = Array.from(e.target.files);\r\n    setSelectedFiles(files);\r\n  };\r\n\r\n  const handleRemoveFile = (index) => {\r\n    setSelectedFiles(selectedFiles.filter((_, i) => i !== index));\r\n  };\r\n\r\n  const handleSendMessage = async (e) => {\r\n    e.preventDefault();\r\n    if (!selectedApplication || (!newMessage.body.trim() && selectedFiles.length === 0)) {\r\n      setError('Please enter a message or attach a file');\r\n      return;\r\n    }\r\n\r\n    setSending(true);\r\n    setUploading(selectedFiles.length > 0);\r\n    setError(null);\r\n    try {\r\n      const app = applications.find(a => a.id.toString() === selectedApplication);\r\n      if (!app) {\r\n        throw new Error('Application not found');\r\n      }\r\n\r\n      // First, upload files if any\r\n      let uploadedDocuments = [];\r\n      if (selectedFiles.length > 0) {\r\n        const formData = new FormData();\r\n        selectedFiles.forEach(file => {\r\n          formData.append('files', file);\r\n        });\r\n        formData.append('description', `Uploaded via messaging: ${newMessage.body || 'No message'}`);\r\n\r\n        const uploadRes = await api.post(`/api/applications/${selectedApplication}/documents/`, formData, {\r\n          headers: { 'Content-Type': 'multipart/form-data' },\r\n        });\r\n        uploadedDocuments = uploadRes.data.documents || [];\r\n      }\r\n\r\n      // Determine recipient if not set\r\n      let recipientId = newMessage.recipient;\r\n      if (!recipientId) {\r\n        const userRole = localStorage.getItem('role');\r\n        if (userRole === 'Borrower') {\r\n          recipientId = app.lender_details?.user?.id || app.lender?.id || '';\r\n        } else if (userRole === 'Lender') {\r\n          recipientId = app.borrower_details?.user?.id || app.project?.borrower?.user?.id || '';\r\n        }\r\n      }\r\n      \r\n      if (!recipientId) {\r\n        setError('Unable to determine recipient. Please select an application.');\r\n        setSending(false);\r\n        setUploading(false);\r\n        return;\r\n      }\r\n\r\n      // Then send the message\r\n      const messageData = {\r\n        application: parseInt(selectedApplication),\r\n        recipient: parseInt(recipientId),\r\n        subject: newMessage.subject || `Re: ${app.project_details?.address || 'Project'}`,\r\n        body: newMessage.body || (selectedFiles.length > 0 ? `Uploaded ${selectedFiles.length} file(s)` : ''),\r\n      };\r\n\r\n      const messageRes = await api.post('/api/messaging/messages/', messageData);\r\n      \r\n      // Link uploaded documents to the message if any\r\n      if (uploadedDocuments.length > 0 && messageRes.data.id) {\r\n        for (const doc of uploadedDocuments) {\r\n          try {\r\n            await api.post('/api/messaging/attachments/', {\r\n              message: messageRes.data.id,\r\n              document: doc.document_id,\r\n            });\r\n          } catch (attachErr) {\r\n            console.warn('Failed to link document to message:', attachErr);\r\n          }\r\n        }\r\n      }\r\n\r\n      setNewMessage({ subject: '', body: '', recipient: '' });\r\n      setSelectedFiles([]);\r\n      if (fileInputRef.current) {\r\n        fileInputRef.current.value = '';\r\n      }\r\n      await loadMessages(selectedApplication);\r\n    } catch (err) {\r\n      console.error('Messages handleSendMessage error:', err);\r\n      setError(err.response?.data?.error || err.response?.data?.detail || 'Failed to send message');\r\n    } finally {\r\n      setSending(false);\r\n      setUploading(false);\r\n    }\r\n  };\r\n\r\n  const getOtherPartyName = (message) => {\r\n    const currentUserId = parseInt(localStorage.getItem('user_id') || '0');\r\n    if (message.sender === currentUserId) {\r\n      return message.recipient_username || 'Recipient';\r\n    }\r\n    return message.sender_username || 'Sender';\r\n  };\r\n\r\n  return (\r\n    <div style={commonStyles.container}>\r\n      <div style={{ marginBottom: theme.spacing.xl }}>\r\n        <h1 style={{\r\n          fontSize: theme.typography.fontSize['4xl'],\r\n          fontWeight: theme.typography.fontWeight.bold,\r\n          margin: `0 0 ${theme.spacing.sm} 0`,\r\n          color: theme.colors.textPrimary,\r\n        }}>\r\n          Messages\r\n        </h1>\r\n        <p style={{\r\n          color: theme.colors.textSecondary,\r\n          fontSize: theme.typography.fontSize.base,\r\n          margin: 0,\r\n        }}>\r\n          Communicate with borrowers and lenders about applications\r\n        </p>\r\n      </div>\r\n\r\n      {error && (\r\n        <div style={{\r\n          background: theme.colors.errorLight,\r\n          color: theme.colors.errorDark,\r\n          padding: theme.spacing.md,\r\n          borderRadius: theme.borderRadius.md,\r\n          marginBottom: theme.spacing.lg,\r\n          border: `1px solid ${theme.colors.error}`,\r\n        }}>\r\n          {error}\r\n        </div>\r\n      )}\r\n\r\n      <div style={{ display: 'grid', gridTemplateColumns: '1fr 2fr', gap: theme.spacing.xl }}>\r\n        {/* Application Selection */}\r\n        <div style={commonStyles.card}>\r\n          <h2 style={{\r\n            fontSize: theme.typography.fontSize.xl,\r\n            fontWeight: theme.typography.fontWeight.semibold,\r\n            margin: `0 0 ${theme.spacing.md} 0`,\r\n          }}>\r\n            Select Application\r\n          </h2>\r\n          <select\r\n            value={selectedApplication}\r\n            onChange={handleSelectApplication}\r\n            style={{\r\n              width: '100%',\r\n              padding: theme.spacing.sm,\r\n              borderRadius: theme.borderRadius.md,\r\n              border: `1px solid ${theme.colors.gray300}`,\r\n              fontSize: theme.typography.fontSize.base,\r\n            }}\r\n          >\r\n            <option value=\"\">-- Select an application --</option>\r\n            {applications.map((app) => {\r\n              const projectRef = app.project_details?.project_reference || '';\r\n              const address = app.project_details?.address || `Project #${app.project}`;\r\n              const otherParty = app.lender_details?.organisation_name || app.borrower_details?.company_name || 'N/A';\r\n              return (\r\n                <option key={app.id} value={app.id}>\r\n                  {projectRef ? `[${projectRef}] ` : ''}{address} - {otherParty}\r\n                </option>\r\n              );\r\n            })}\r\n          </select>\r\n        </div>\r\n\r\n        {/* Messages */}\r\n        <div style={commonStyles.card}>\r\n          {!selectedApplication ? (\r\n            <div style={{ textAlign: 'center', padding: theme.spacing['2xl'] }}>\r\n              <p style={{ color: theme.colors.textSecondary }}>\r\n                Select an application to view messages\r\n              </p>\r\n            </div>\r\n          ) : loading ? (\r\n            <div style={{ textAlign: 'center', padding: theme.spacing['2xl'] }}>\r\n              <p style={{ color: theme.colors.textSecondary }}>Loading messages...</p>\r\n            </div>\r\n          ) : (\r\n            <>\r\n              <div style={{\r\n                maxHeight: '500px',\r\n                overflowY: 'auto',\r\n                marginBottom: theme.spacing.lg,\r\n                padding: theme.spacing.md,\r\n                background: theme.colors.gray50,\r\n                borderRadius: theme.borderRadius.md,\r\n                display: 'flex',\r\n                flexDirection: 'column',\r\n              }}>\r\n                {messages.length === 0 ? (\r\n                  <p style={{ color: theme.colors.textSecondary, textAlign: 'center' }}>\r\n                    No messages yet. Start the conversation below.\r\n                  </p>\r\n                ) : (\r\n                  <>\r\n                    {messages.map((message) => {\r\n                      const isSent = message.sender_username === localStorage.getItem('username');\r\n                      return (\r\n                        <div\r\n                          key={message.id}\r\n                          style={{\r\n                            marginBottom: theme.spacing.sm,\r\n                            padding: theme.spacing.sm,\r\n                            background: isSent ? theme.colors.primary : theme.colors.white,\r\n                            color: isSent ? theme.colors.white : theme.colors.textPrimary,\r\n                            borderRadius: theme.borderRadius.md,\r\n                            maxWidth: '75%',\r\n                            alignSelf: isSent ? 'flex-end' : 'flex-start',\r\n                            boxShadow: '0 1px 2px rgba(0,0,0,0.1)',\r\n                          }}\r\n                        >\r\n                          <div style={{\r\n                            fontSize: theme.typography.fontSize.xs,\r\n                            opacity: 0.8,\r\n                            marginBottom: theme.spacing.xs,\r\n                          }}>\r\n                            {new Date(message.created_at).toLocaleTimeString()}\r\n                          </div>\r\n                          <div style={{ marginBottom: theme.spacing.xs }}>\r\n                            {message.body}\r\n                          </div>\r\n                          {message.attachments && message.attachments.length > 0 && (\r\n                            <div style={{ marginTop: theme.spacing.xs }}>\r\n                              {message.attachments.map((att, idx) => (\r\n                                <div key={idx} style={{\r\n                                  fontSize: theme.typography.fontSize.xs,\r\n                                  opacity: 0.9,\r\n                                  marginTop: theme.spacing.xs,\r\n                                }}>\r\n                                  ðŸ“Ž {att.document?.file_name || 'Attachment'}\r\n                                </div>\r\n                              ))}\r\n                            </div>\r\n                          )}\r\n                        </div>\r\n                      );\r\n                    })}\r\n                    <div ref={messagesEndRef} />\r\n                  </>\r\n                )}\r\n              </div>\r\n\r\n              {/* Send Message Form */}\r\n              <form onSubmit={handleSendMessage}>\r\n                <Input\r\n                  label=\"Subject\"\r\n                  value={newMessage.subject}\r\n                  onChange={(e) => setNewMessage({ ...newMessage, subject: e.target.value })}\r\n                  placeholder=\"Message subject (optional)\"\r\n                />\r\n                <Textarea\r\n                  label=\"Message\"\r\n                  value={newMessage.body}\r\n                  onChange={(e) => setNewMessage({ ...newMessage, body: e.target.value })}\r\n                  placeholder=\"Type your message here...\"\r\n                  rows={3}\r\n                />\r\n                \r\n                {/* File Upload */}\r\n                <div style={{ marginBottom: theme.spacing.md }}>\r\n                  <input\r\n                    ref={fileInputRef}\r\n                    type=\"file\"\r\n                    multiple\r\n                    onChange={handleFileSelect}\r\n                    style={{ display: 'none' }}\r\n                  />\r\n                  <div style={{ display: 'flex', gap: theme.spacing.sm, alignItems: 'center' }}>\r\n                    <Button\r\n                      type=\"button\"\r\n                      variant=\"outline\"\r\n                      size=\"sm\"\r\n                      onClick={() => fileInputRef.current?.click()}\r\n                    >\r\n                      ðŸ“Ž Attach Files\r\n                    </Button>\r\n                    {selectedFiles.length > 0 && (\r\n                      <span style={{ fontSize: theme.typography.fontSize.sm, color: theme.colors.textSecondary }}>\r\n                        {selectedFiles.length} file(s) selected\r\n                      </span>\r\n                    )}\r\n                  </div>\r\n                  {selectedFiles.length > 0 && (\r\n                    <div style={{ marginTop: theme.spacing.sm }}>\r\n                      {selectedFiles.map((file, index) => (\r\n                        <div key={index} style={{\r\n                          display: 'flex',\r\n                          alignItems: 'center',\r\n                          justifyContent: 'space-between',\r\n                          padding: theme.spacing.xs,\r\n                          background: theme.colors.gray100,\r\n                          borderRadius: theme.borderRadius.sm,\r\n                          marginBottom: theme.spacing.xs,\r\n                        }}>\r\n                          <span style={{ fontSize: theme.typography.fontSize.sm }}>\r\n                            {file.name} ({(file.size / 1024).toFixed(1)} KB)\r\n                          </span>\r\n                          <Button\r\n                            type=\"button\"\r\n                            variant=\"outline\"\r\n                            size=\"sm\"\r\n                            onClick={() => handleRemoveFile(index)}\r\n                          >\r\n                            Ã—\r\n                          </Button>\r\n                        </div>\r\n                      ))}\r\n                    </div>\r\n                  )}\r\n                </div>\r\n\r\n                <Button\r\n                  type=\"submit\"\r\n                  disabled={sending || uploading || (!newMessage.body.trim() && selectedFiles.length === 0)}\r\n                  variant=\"primary\"\r\n                >\r\n                  {uploading ? 'Uploading...' : sending ? 'Sending...' : 'Send Message'}\r\n                </Button>\r\n              </form>\r\n            </>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default Messages;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}