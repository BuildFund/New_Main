{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\paul-\\\\OneDrive - BARE Capital Ltd\\\\BARE Drive\\\\10.0 BUILDFUND\\\\1.0 Website Dev\\\\GitHub\\\\new_website\\\\src\\\\pages\\\\Messages.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useState, useRef } from 'react';\nimport { useSearchParams } from 'react-router-dom';\nimport api from '../api';\nimport { theme, commonStyles } from '../styles/theme';\nimport Button from '../components/Button';\nimport Textarea from '../components/Textarea';\nimport Input from '../components/Input';\nimport Badge from '../components/Badge';\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nfunction Messages() {\n  _s();\n  const [searchParams] = useSearchParams();\n  const applicationId = searchParams.get('application_id');\n  const [messages, setMessages] = useState([]);\n  const [applications, setApplications] = useState([]);\n  const [selectedApplication, setSelectedApplication] = useState(applicationId || '');\n  const [newMessage, setNewMessage] = useState({\n    subject: '',\n    body: '',\n    recipient: ''\n  });\n  const [error, setError] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const [sending, setSending] = useState(false);\n  const [uploading, setUploading] = useState(false);\n  const [selectedFiles, setSelectedFiles] = useState([]);\n  const messagesEndRef = useRef(null);\n  const fileInputRef = useRef(null);\n  useEffect(() => {\n    loadApplications();\n    if (applicationId) {\n      setSelectedApplication(applicationId);\n      loadMessages(applicationId);\n    } else {\n      setLoading(false);\n    }\n  }, [applicationId]);\n  async function loadApplications() {\n    try {\n      const res = await api.get('/api/applications/');\n      setApplications(res.data || []);\n    } catch (err) {\n      console.error('Messages loadApplications error:', err);\n    }\n  }\n  async function loadMessages(appId) {\n    if (!appId) {\n      setMessages([]);\n      return;\n    }\n    setLoading(true);\n    setError(null);\n    try {\n      const res = await api.get(`/api/messaging/messages/by_application/?application_id=${appId}`);\n      // Reverse to show newest at bottom (WhatsApp style)\n      const messagesList = res.data || [];\n      setMessages([...messagesList].reverse());\n      // Scroll to bottom after messages load\n      setTimeout(() => {\n        var _messagesEndRef$curre;\n        (_messagesEndRef$curre = messagesEndRef.current) === null || _messagesEndRef$curre === void 0 ? void 0 : _messagesEndRef$curre.scrollIntoView({\n          behavior: 'smooth'\n        });\n      }, 100);\n    } catch (err) {\n      console.error('Messages loadMessages error:', err);\n      setError('Failed to load messages');\n    } finally {\n      setLoading(false);\n    }\n  }\n  useEffect(() => {\n    // Scroll to bottom when messages change\n    if (messages.length > 0) {\n      setTimeout(() => {\n        var _messagesEndRef$curre2;\n        (_messagesEndRef$curre2 = messagesEndRef.current) === null || _messagesEndRef$curre2 === void 0 ? void 0 : _messagesEndRef$curre2.scrollIntoView({\n          behavior: 'smooth'\n        });\n      }, 100);\n    }\n  }, [messages]);\n  const handleSelectApplication = e => {\n    const appId = e.target.value;\n    setSelectedApplication(appId);\n    if (appId) {\n      loadMessages(appId);\n      // Find the application to get recipient info\n      const app = applications.find(a => a.id.toString() === appId);\n      if (app) {\n        var _app$project_details, _app$project_details2;\n        // Determine recipient based on user role\n        const userRole = localStorage.getItem('role');\n        let recipientId = '';\n        if (userRole === 'Borrower') {\n          var _app$lender_details, _app$lender_details$u, _app$lender_details2;\n          recipientId = ((_app$lender_details = app.lender_details) === null || _app$lender_details === void 0 ? void 0 : (_app$lender_details$u = _app$lender_details.user) === null || _app$lender_details$u === void 0 ? void 0 : _app$lender_details$u.id) || ((_app$lender_details2 = app.lender_details) === null || _app$lender_details2 === void 0 ? void 0 : _app$lender_details2.user) || '';\n        } else if (userRole === 'Lender') {\n          var _app$borrower_details, _app$borrower_details2, _app$borrower_details3;\n          recipientId = ((_app$borrower_details = app.borrower_details) === null || _app$borrower_details === void 0 ? void 0 : (_app$borrower_details2 = _app$borrower_details.user) === null || _app$borrower_details2 === void 0 ? void 0 : _app$borrower_details2.id) || ((_app$borrower_details3 = app.borrower_details) === null || _app$borrower_details3 === void 0 ? void 0 : _app$borrower_details3.user) || '';\n        }\n        // Auto-populate subject with project reference if available\n        const projectRef = ((_app$project_details = app.project_details) === null || _app$project_details === void 0 ? void 0 : _app$project_details.project_reference) || '';\n        const defaultSubject = projectRef ? `Re: Project ${projectRef}` : `Re: ${((_app$project_details2 = app.project_details) === null || _app$project_details2 === void 0 ? void 0 : _app$project_details2.address) || 'Project'}`;\n        setNewMessage({\n          ...newMessage,\n          recipient: recipientId,\n          subject: newMessage.subject || defaultSubject\n        });\n      }\n    } else {\n      setMessages([]);\n    }\n  };\n  const handleSendMessage = async e => {\n    e.preventDefault();\n    if (!selectedApplication || !newMessage.body.trim()) {\n      setError('Please select an application and enter a message');\n      return;\n    }\n    setSending(true);\n    setError(null);\n    try {\n      var _app$project_details3;\n      const app = applications.find(a => a.id.toString() === selectedApplication);\n      if (!app) {\n        throw new Error('Application not found');\n      }\n      await api.post('/api/messaging/messages/', {\n        application: selectedApplication,\n        recipient: newMessage.recipient,\n        subject: newMessage.subject || `Re: ${((_app$project_details3 = app.project_details) === null || _app$project_details3 === void 0 ? void 0 : _app$project_details3.address) || 'Project'}`,\n        body: newMessage.body\n      });\n      setNewMessage({\n        subject: '',\n        body: '',\n        recipient: ''\n      });\n      await loadMessages(selectedApplication);\n    } catch (err) {\n      var _err$response, _err$response$data, _err$response2, _err$response2$data;\n      console.error('Messages handleSendMessage error:', err);\n      setError(((_err$response = err.response) === null || _err$response === void 0 ? void 0 : (_err$response$data = _err$response.data) === null || _err$response$data === void 0 ? void 0 : _err$response$data.error) || ((_err$response2 = err.response) === null || _err$response2 === void 0 ? void 0 : (_err$response2$data = _err$response2.data) === null || _err$response2$data === void 0 ? void 0 : _err$response2$data.detail) || 'Failed to send message');\n    } finally {\n      setSending(false);\n    }\n  };\n  const getOtherPartyName = message => {\n    const currentUserId = parseInt(localStorage.getItem('user_id') || '0');\n    if (message.sender === currentUserId) {\n      return message.recipient_username || 'Recipient';\n    }\n    return message.sender_username || 'Sender';\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: commonStyles.container,\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        marginBottom: theme.spacing.xl\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n        style: {\n          fontSize: theme.typography.fontSize['4xl'],\n          fontWeight: theme.typography.fontWeight.bold,\n          margin: `0 0 ${theme.spacing.sm} 0`,\n          color: theme.colors.textPrimary\n        },\n        children: \"Messages\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 154,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        style: {\n          color: theme.colors.textSecondary,\n          fontSize: theme.typography.fontSize.base,\n          margin: 0\n        },\n        children: \"Communicate with borrowers and lenders about applications\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 162,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 153,\n      columnNumber: 7\n    }, this), error && /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        background: theme.colors.errorLight,\n        color: theme.colors.errorDark,\n        padding: theme.spacing.md,\n        borderRadius: theme.borderRadius.md,\n        marginBottom: theme.spacing.lg,\n        border: `1px solid ${theme.colors.error}`\n      },\n      children: error\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 172,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        display: 'grid',\n        gridTemplateColumns: '1fr 2fr',\n        gap: theme.spacing.xl\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        style: commonStyles.card,\n        children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n          style: {\n            fontSize: theme.typography.fontSize.xl,\n            fontWeight: theme.typography.fontWeight.semibold,\n            margin: `0 0 ${theme.spacing.md} 0`\n          },\n          children: \"Select Application\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 187,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"select\", {\n          value: selectedApplication,\n          onChange: handleSelectApplication,\n          style: {\n            width: '100%',\n            padding: theme.spacing.sm,\n            borderRadius: theme.borderRadius.md,\n            border: `1px solid ${theme.colors.gray300}`,\n            fontSize: theme.typography.fontSize.base\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"option\", {\n            value: \"\",\n            children: \"-- Select an application --\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 205,\n            columnNumber: 13\n          }, this), applications.map(app => {\n            var _app$project_details4, _app$project_details5, _app$lender_details3, _app$borrower_details4;\n            const projectRef = ((_app$project_details4 = app.project_details) === null || _app$project_details4 === void 0 ? void 0 : _app$project_details4.project_reference) || '';\n            const address = ((_app$project_details5 = app.project_details) === null || _app$project_details5 === void 0 ? void 0 : _app$project_details5.address) || `Project #${app.project}`;\n            const otherParty = ((_app$lender_details3 = app.lender_details) === null || _app$lender_details3 === void 0 ? void 0 : _app$lender_details3.organisation_name) || ((_app$borrower_details4 = app.borrower_details) === null || _app$borrower_details4 === void 0 ? void 0 : _app$borrower_details4.company_name) || 'N/A';\n            return /*#__PURE__*/_jsxDEV(\"option\", {\n              value: app.id,\n              children: [projectRef ? `[${projectRef}] ` : '', address, \" - \", otherParty]\n            }, app.id, true, {\n              fileName: _jsxFileName,\n              lineNumber: 211,\n              columnNumber: 17\n            }, this);\n          })]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 194,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 186,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: commonStyles.card,\n        children: !selectedApplication ? /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            textAlign: 'center',\n            padding: theme.spacing['2xl']\n          },\n          children: /*#__PURE__*/_jsxDEV(\"p\", {\n            style: {\n              color: theme.colors.textSecondary\n            },\n            children: \"Select an application to view messages\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 223,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 222,\n          columnNumber: 13\n        }, this) : loading ? /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            textAlign: 'center',\n            padding: theme.spacing['2xl']\n          },\n          children: /*#__PURE__*/_jsxDEV(\"p\", {\n            style: {\n              color: theme.colors.textSecondary\n            },\n            children: \"Loading messages...\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 229,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 228,\n          columnNumber: 13\n        }, this) : /*#__PURE__*/_jsxDEV(_Fragment, {\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              maxHeight: '400px',\n              overflowY: 'auto',\n              marginBottom: theme.spacing.lg,\n              padding: theme.spacing.md,\n              background: theme.colors.gray50,\n              borderRadius: theme.borderRadius.md\n            },\n            children: messages.length === 0 ? /*#__PURE__*/_jsxDEV(\"p\", {\n              style: {\n                color: theme.colors.textSecondary,\n                textAlign: 'center'\n              },\n              children: \"No messages yet. Start the conversation below.\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 242,\n              columnNumber: 19\n            }, this) : messages.map(message => {\n              const isSent = message.sender_username === localStorage.getItem('username');\n              return /*#__PURE__*/_jsxDEV(\"div\", {\n                style: {\n                  marginBottom: theme.spacing.md,\n                  padding: theme.spacing.md,\n                  background: isSent ? theme.colors.primaryLight : theme.colors.white,\n                  borderRadius: theme.borderRadius.md,\n                  border: `1px solid ${theme.colors.gray200}`,\n                  marginLeft: isSent ? '20%' : '0',\n                  marginRight: isSent ? '0' : '20%'\n                },\n                children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                  style: {\n                    display: 'flex',\n                    justifyContent: 'space-between',\n                    marginBottom: theme.spacing.xs\n                  },\n                  children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                    children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n                      children: message.subject\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 267,\n                      columnNumber: 29\n                    }, this), message.project_reference && /*#__PURE__*/_jsxDEV(Badge, {\n                      variant: \"info\",\n                      style: {\n                        marginLeft: theme.spacing.sm\n                      },\n                      children: [\"Ref: \", message.project_reference]\n                    }, void 0, true, {\n                      fileName: _jsxFileName,\n                      lineNumber: 269,\n                      columnNumber: 31\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 266,\n                    columnNumber: 27\n                  }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                    style: {\n                      fontSize: theme.typography.fontSize.sm,\n                      color: theme.colors.textSecondary\n                    },\n                    children: new Date(message.created_at).toLocaleString()\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 274,\n                    columnNumber: 27\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 261,\n                  columnNumber: 25\n                }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                  style: {\n                    margin: 0,\n                    color: theme.colors.textPrimary\n                  },\n                  children: message.body\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 281,\n                  columnNumber: 25\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  style: {\n                    marginTop: theme.spacing.xs,\n                    fontSize: theme.typography.fontSize.sm,\n                    color: theme.colors.textSecondary\n                  },\n                  children: [\"From: \", message.sender_username || 'Unknown', message.project_reference && /*#__PURE__*/_jsxDEV(\"span\", {\n                    style: {\n                      marginLeft: theme.spacing.md\n                    },\n                    children: [\"\\u2022 Project: \", message.project_reference]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 291,\n                    columnNumber: 29\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 284,\n                  columnNumber: 25\n                }, this)]\n              }, message.id, true, {\n                fileName: _jsxFileName,\n                lineNumber: 249,\n                columnNumber: 23\n              }, this);\n            })\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 233,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"form\", {\n            onSubmit: handleSendMessage,\n            children: [/*#__PURE__*/_jsxDEV(Input, {\n              label: \"Subject\",\n              value: newMessage.subject,\n              onChange: e => setNewMessage({\n                ...newMessage,\n                subject: e.target.value\n              }),\n              placeholder: \"Message subject\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 304,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(Textarea, {\n              label: \"Message\",\n              value: newMessage.body,\n              onChange: e => setNewMessage({\n                ...newMessage,\n                body: e.target.value\n              }),\n              placeholder: \"Type your message here...\",\n              rows: 4,\n              required: true\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 310,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(Button, {\n              type: \"submit\",\n              disabled: sending || !newMessage.body.trim(),\n              variant: \"primary\",\n              children: sending ? 'Sending...' : 'Send Message'\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 318,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 303,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 220,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 184,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 152,\n    columnNumber: 5\n  }, this);\n}\n_s(Messages, \"Oh6/Hkn+W/z8PBY0oBnKD4Rk2Dc=\", false, function () {\n  return [useSearchParams];\n});\n_c = Messages;\nexport default Messages;\nvar _c;\n$RefreshReg$(_c, \"Messages\");","map":{"version":3,"names":["React","useEffect","useState","useRef","useSearchParams","api","theme","commonStyles","Button","Textarea","Input","Badge","jsxDEV","_jsxDEV","Fragment","_Fragment","Messages","_s","searchParams","applicationId","get","messages","setMessages","applications","setApplications","selectedApplication","setSelectedApplication","newMessage","setNewMessage","subject","body","recipient","error","setError","loading","setLoading","sending","setSending","uploading","setUploading","selectedFiles","setSelectedFiles","messagesEndRef","fileInputRef","loadApplications","loadMessages","res","data","err","console","appId","messagesList","reverse","setTimeout","_messagesEndRef$curre","current","scrollIntoView","behavior","length","_messagesEndRef$curre2","handleSelectApplication","e","target","value","app","find","a","id","toString","_app$project_details","_app$project_details2","userRole","localStorage","getItem","recipientId","_app$lender_details","_app$lender_details$u","_app$lender_details2","lender_details","user","_app$borrower_details","_app$borrower_details2","_app$borrower_details3","borrower_details","projectRef","project_details","project_reference","defaultSubject","address","handleSendMessage","preventDefault","trim","_app$project_details3","Error","post","application","_err$response","_err$response$data","_err$response2","_err$response2$data","response","detail","getOtherPartyName","message","currentUserId","parseInt","sender","recipient_username","sender_username","style","container","children","marginBottom","spacing","xl","fontSize","typography","fontWeight","bold","margin","sm","color","colors","textPrimary","fileName","_jsxFileName","lineNumber","columnNumber","textSecondary","base","background","errorLight","errorDark","padding","md","borderRadius","lg","border","display","gridTemplateColumns","gap","card","semibold","onChange","width","gray300","map","_app$project_details4","_app$project_details5","_app$lender_details3","_app$borrower_details4","project","otherParty","organisation_name","company_name","textAlign","maxHeight","overflowY","gray50","isSent","primaryLight","white","gray200","marginLeft","marginRight","justifyContent","xs","variant","Date","created_at","toLocaleString","marginTop","onSubmit","label","placeholder","rows","required","type","disabled","_c","$RefreshReg$"],"sources":["C:/Users/paul-/OneDrive - BARE Capital Ltd/BARE Drive/10.0 BUILDFUND/1.0 Website Dev/GitHub/new_website/src/pages/Messages.js"],"sourcesContent":["import React, { useEffect, useState, useRef } from 'react';\r\nimport { useSearchParams } from 'react-router-dom';\r\nimport api from '../api';\r\nimport { theme, commonStyles } from '../styles/theme';\r\nimport Button from '../components/Button';\r\nimport Textarea from '../components/Textarea';\r\nimport Input from '../components/Input';\r\nimport Badge from '../components/Badge';\r\n\r\nfunction Messages() {\r\n  const [searchParams] = useSearchParams();\r\n  const applicationId = searchParams.get('application_id');\r\n  \r\n  const [messages, setMessages] = useState([]);\r\n  const [applications, setApplications] = useState([]);\r\n  const [selectedApplication, setSelectedApplication] = useState(applicationId || '');\r\n  const [newMessage, setNewMessage] = useState({ subject: '', body: '', recipient: '' });\r\n  const [error, setError] = useState(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [sending, setSending] = useState(false);\r\n  const [uploading, setUploading] = useState(false);\r\n  const [selectedFiles, setSelectedFiles] = useState([]);\r\n  const messagesEndRef = useRef(null);\r\n  const fileInputRef = useRef(null);\r\n\r\n  useEffect(() => {\r\n    loadApplications();\r\n    if (applicationId) {\r\n      setSelectedApplication(applicationId);\r\n      loadMessages(applicationId);\r\n    } else {\r\n      setLoading(false);\r\n    }\r\n  }, [applicationId]);\r\n\r\n  async function loadApplications() {\r\n    try {\r\n      const res = await api.get('/api/applications/');\r\n      setApplications(res.data || []);\r\n    } catch (err) {\r\n      console.error('Messages loadApplications error:', err);\r\n    }\r\n  }\r\n\r\n  async function loadMessages(appId) {\r\n    if (!appId) {\r\n      setMessages([]);\r\n      return;\r\n    }\r\n\r\n    setLoading(true);\r\n    setError(null);\r\n    try {\r\n      const res = await api.get(`/api/messaging/messages/by_application/?application_id=${appId}`);\r\n      // Reverse to show newest at bottom (WhatsApp style)\r\n      const messagesList = res.data || [];\r\n      setMessages([...messagesList].reverse());\r\n      // Scroll to bottom after messages load\r\n      setTimeout(() => {\r\n        messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\r\n      }, 100);\r\n    } catch (err) {\r\n      console.error('Messages loadMessages error:', err);\r\n      setError('Failed to load messages');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }\r\n\r\n  useEffect(() => {\r\n    // Scroll to bottom when messages change\r\n    if (messages.length > 0) {\r\n      setTimeout(() => {\r\n        messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\r\n      }, 100);\r\n    }\r\n  }, [messages]);\r\n\r\n  const handleSelectApplication = (e) => {\r\n    const appId = e.target.value;\r\n    setSelectedApplication(appId);\r\n    if (appId) {\r\n      loadMessages(appId);\r\n      // Find the application to get recipient info\r\n      const app = applications.find(a => a.id.toString() === appId);\r\n      if (app) {\r\n        // Determine recipient based on user role\r\n        const userRole = localStorage.getItem('role');\r\n        let recipientId = '';\r\n        if (userRole === 'Borrower') {\r\n          recipientId = app.lender_details?.user?.id || app.lender_details?.user || '';\r\n        } else if (userRole === 'Lender') {\r\n          recipientId = app.borrower_details?.user?.id || app.borrower_details?.user || '';\r\n        }\r\n        // Auto-populate subject with project reference if available\r\n        const projectRef = app.project_details?.project_reference || '';\r\n        const defaultSubject = projectRef \r\n          ? `Re: Project ${projectRef}`\r\n          : `Re: ${app.project_details?.address || 'Project'}`;\r\n        setNewMessage({ \r\n          ...newMessage, \r\n          recipient: recipientId,\r\n          subject: newMessage.subject || defaultSubject,\r\n        });\r\n      }\r\n    } else {\r\n      setMessages([]);\r\n    }\r\n  };\r\n\r\n  const handleSendMessage = async (e) => {\r\n    e.preventDefault();\r\n    if (!selectedApplication || !newMessage.body.trim()) {\r\n      setError('Please select an application and enter a message');\r\n      return;\r\n    }\r\n\r\n    setSending(true);\r\n    setError(null);\r\n    try {\r\n      const app = applications.find(a => a.id.toString() === selectedApplication);\r\n      if (!app) {\r\n        throw new Error('Application not found');\r\n      }\r\n\r\n      await api.post('/api/messaging/messages/', {\r\n        application: selectedApplication,\r\n        recipient: newMessage.recipient,\r\n        subject: newMessage.subject || `Re: ${app.project_details?.address || 'Project'}`,\r\n        body: newMessage.body,\r\n      });\r\n\r\n      setNewMessage({ subject: '', body: '', recipient: '' });\r\n      await loadMessages(selectedApplication);\r\n    } catch (err) {\r\n      console.error('Messages handleSendMessage error:', err);\r\n      setError(err.response?.data?.error || err.response?.data?.detail || 'Failed to send message');\r\n    } finally {\r\n      setSending(false);\r\n    }\r\n  };\r\n\r\n  const getOtherPartyName = (message) => {\r\n    const currentUserId = parseInt(localStorage.getItem('user_id') || '0');\r\n    if (message.sender === currentUserId) {\r\n      return message.recipient_username || 'Recipient';\r\n    }\r\n    return message.sender_username || 'Sender';\r\n  };\r\n\r\n  return (\r\n    <div style={commonStyles.container}>\r\n      <div style={{ marginBottom: theme.spacing.xl }}>\r\n        <h1 style={{\r\n          fontSize: theme.typography.fontSize['4xl'],\r\n          fontWeight: theme.typography.fontWeight.bold,\r\n          margin: `0 0 ${theme.spacing.sm} 0`,\r\n          color: theme.colors.textPrimary,\r\n        }}>\r\n          Messages\r\n        </h1>\r\n        <p style={{\r\n          color: theme.colors.textSecondary,\r\n          fontSize: theme.typography.fontSize.base,\r\n          margin: 0,\r\n        }}>\r\n          Communicate with borrowers and lenders about applications\r\n        </p>\r\n      </div>\r\n\r\n      {error && (\r\n        <div style={{\r\n          background: theme.colors.errorLight,\r\n          color: theme.colors.errorDark,\r\n          padding: theme.spacing.md,\r\n          borderRadius: theme.borderRadius.md,\r\n          marginBottom: theme.spacing.lg,\r\n          border: `1px solid ${theme.colors.error}`,\r\n        }}>\r\n          {error}\r\n        </div>\r\n      )}\r\n\r\n      <div style={{ display: 'grid', gridTemplateColumns: '1fr 2fr', gap: theme.spacing.xl }}>\r\n        {/* Application Selection */}\r\n        <div style={commonStyles.card}>\r\n          <h2 style={{\r\n            fontSize: theme.typography.fontSize.xl,\r\n            fontWeight: theme.typography.fontWeight.semibold,\r\n            margin: `0 0 ${theme.spacing.md} 0`,\r\n          }}>\r\n            Select Application\r\n          </h2>\r\n          <select\r\n            value={selectedApplication}\r\n            onChange={handleSelectApplication}\r\n            style={{\r\n              width: '100%',\r\n              padding: theme.spacing.sm,\r\n              borderRadius: theme.borderRadius.md,\r\n              border: `1px solid ${theme.colors.gray300}`,\r\n              fontSize: theme.typography.fontSize.base,\r\n            }}\r\n          >\r\n            <option value=\"\">-- Select an application --</option>\r\n            {applications.map((app) => {\r\n              const projectRef = app.project_details?.project_reference || '';\r\n              const address = app.project_details?.address || `Project #${app.project}`;\r\n              const otherParty = app.lender_details?.organisation_name || app.borrower_details?.company_name || 'N/A';\r\n              return (\r\n                <option key={app.id} value={app.id}>\r\n                  {projectRef ? `[${projectRef}] ` : ''}{address} - {otherParty}\r\n                </option>\r\n              );\r\n            })}\r\n          </select>\r\n        </div>\r\n\r\n        {/* Messages */}\r\n        <div style={commonStyles.card}>\r\n          {!selectedApplication ? (\r\n            <div style={{ textAlign: 'center', padding: theme.spacing['2xl'] }}>\r\n              <p style={{ color: theme.colors.textSecondary }}>\r\n                Select an application to view messages\r\n              </p>\r\n            </div>\r\n          ) : loading ? (\r\n            <div style={{ textAlign: 'center', padding: theme.spacing['2xl'] }}>\r\n              <p style={{ color: theme.colors.textSecondary }}>Loading messages...</p>\r\n            </div>\r\n          ) : (\r\n            <>\r\n              <div style={{\r\n                maxHeight: '400px',\r\n                overflowY: 'auto',\r\n                marginBottom: theme.spacing.lg,\r\n                padding: theme.spacing.md,\r\n                background: theme.colors.gray50,\r\n                borderRadius: theme.borderRadius.md,\r\n              }}>\r\n                {messages.length === 0 ? (\r\n                  <p style={{ color: theme.colors.textSecondary, textAlign: 'center' }}>\r\n                    No messages yet. Start the conversation below.\r\n                  </p>\r\n                ) : (\r\n                  messages.map((message) => {\r\n                    const isSent = message.sender_username === localStorage.getItem('username');\r\n                    return (\r\n                      <div\r\n                        key={message.id}\r\n                        style={{\r\n                          marginBottom: theme.spacing.md,\r\n                          padding: theme.spacing.md,\r\n                          background: isSent ? theme.colors.primaryLight : theme.colors.white,\r\n                          borderRadius: theme.borderRadius.md,\r\n                          border: `1px solid ${theme.colors.gray200}`,\r\n                          marginLeft: isSent ? '20%' : '0',\r\n                          marginRight: isSent ? '0' : '20%',\r\n                        }}\r\n                      >\r\n                        <div style={{\r\n                          display: 'flex',\r\n                          justifyContent: 'space-between',\r\n                          marginBottom: theme.spacing.xs,\r\n                        }}>\r\n                          <div>\r\n                            <strong>{message.subject}</strong>\r\n                            {message.project_reference && (\r\n                              <Badge variant=\"info\" style={{ marginLeft: theme.spacing.sm }}>\r\n                                Ref: {message.project_reference}\r\n                              </Badge>\r\n                            )}\r\n                          </div>\r\n                          <span style={{\r\n                            fontSize: theme.typography.fontSize.sm,\r\n                            color: theme.colors.textSecondary,\r\n                          }}>\r\n                            {new Date(message.created_at).toLocaleString()}\r\n                          </span>\r\n                        </div>\r\n                        <p style={{ margin: 0, color: theme.colors.textPrimary }}>\r\n                          {message.body}\r\n                        </p>\r\n                        <div style={{\r\n                          marginTop: theme.spacing.xs,\r\n                          fontSize: theme.typography.fontSize.sm,\r\n                          color: theme.colors.textSecondary,\r\n                        }}>\r\n                          From: {message.sender_username || 'Unknown'}\r\n                          {message.project_reference && (\r\n                            <span style={{ marginLeft: theme.spacing.md }}>\r\n                              â€¢ Project: {message.project_reference}\r\n                            </span>\r\n                          )}\r\n                        </div>\r\n                      </div>\r\n                    );\r\n                  })\r\n                )}\r\n              </div>\r\n\r\n              {/* Send Message Form */}\r\n              <form onSubmit={handleSendMessage}>\r\n                <Input\r\n                  label=\"Subject\"\r\n                  value={newMessage.subject}\r\n                  onChange={(e) => setNewMessage({ ...newMessage, subject: e.target.value })}\r\n                  placeholder=\"Message subject\"\r\n                />\r\n                <Textarea\r\n                  label=\"Message\"\r\n                  value={newMessage.body}\r\n                  onChange={(e) => setNewMessage({ ...newMessage, body: e.target.value })}\r\n                  placeholder=\"Type your message here...\"\r\n                  rows={4}\r\n                  required\r\n                />\r\n                <Button\r\n                  type=\"submit\"\r\n                  disabled={sending || !newMessage.body.trim()}\r\n                  variant=\"primary\"\r\n                >\r\n                  {sending ? 'Sending...' : 'Send Message'}\r\n                </Button>\r\n              </form>\r\n            </>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default Messages;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}